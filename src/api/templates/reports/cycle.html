<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cycle Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/cycle_report.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='image/favicon.ico') }}"
    />
    <script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chartjs-plugin-datalabels.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/reports.js') }}"></script>
  </head>
  <body class="mat-typography">
    <!-- For accessing stats within Javascript -->
    <div style="display: none">
      <p id="overallStats">{{ json.dumps(cycle.stats.stats) }}</p>
      <p id="indicatorStats">{{ json.dumps(cycle.stats.indicator_stats) }}</p>
      <p id="recommendations">{{ json.dumps(recommendations) }}</p>
      <p id="templateStats">{{ json.dumps(stats.template_stats) }}</p>
      <p id="timeIntervalStats">{{ json.dumps(stats.time_stats) }}</p>
    </div>
    <!-- PAGE 1 - Cover Page -->
    <div class="page" style="padding: 0">
      <div class="row">
        <div id="blueDateBox">
          <span class="year">{{ datetime.utcnow().strftime("%Y")}}</span><br />
          <span class="dateRange">
            {{ cycle.start_date.strftime("%Y-%m-%d") }} - {{
            cycle.end_date.strftime("%Y-%m-%d") }}
          </span>
        </div>
      </div>
      <div class="row">
        <div id="bluePhishLogo" class="col-12">
          <img
            src="{{ url_for('static', filename='image/blue_phishlogo.png') }}"
          />
        </div>
      </div>
      <div class="row">
        <div id="whiteBox" class="col-5"></div>
      </div>
      <div class="row">
        <div id="leftYellowBox"></div>
      </div>
      <div class="row">
        <div id="rightYellowBox"></div>
      </div>
      <div class="row">
        <div id="blueHacker" class="col-12">
          <img
            src="{{ url_for('static', filename='image/blue_hacker.png') }}"
          />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <h2 id="reportTitle">
            <span class="smallerTitle">Cycle</span><br />Report
          </h2>
        </div>
        <div class="col">
          <h2 id="reportDate">
            <br /><span class="smallerTitle"
              >{{ datetime.utcnow().strftime('%b %d, %Y') }}</span
            >
          </h2>
        </div>
      </div>
      <div id="coverFooter" class="row mb-2">
        <div id="preparationDetails">
          Prepared for:<br />
          {{ customer.name }}<br />
          {{ customer.address_1 }} {{ customer.address_2 }}<br />
          {{ customer.city }}, {{ customer.state }} {{ customer.zip_code }}
        </div>
        <div id="dhsContactDetails">
          <div class="mb-2">
            Subscription Primary Contact<br />
            {{ subscription.primary_contact.first_name }} {{
            subscription.primary_contact.last_name }}<br />
            {{ subscription.primary_contact.email }}<br />
          </div>
          <div>
            CISA Contact<br />
            vulnerability@cisa.dhs.gov
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 2 - Assessment Details -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <table class="detailsTable">
              <thead>
                <tr>
                  <th colspan="2">
                    Continuous Phishing Campaign Assessment Details
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Customer Name:</th>
                  <td>{{ customer.name }}</td>
                </tr>
                <tr>
                  <th>Customer POC:</th>
                  <td>
                    {{ subscription.primary_contact.first_name }} {{
                    subscription.primary_contact.last_name }}
                  </td>
                </tr>
                <tr>
                  <th>Vulnerability Management:</th>
                  <td>vulnerability@cisa.dhs.gov</td>
                </tr>
                <tr>
                  <th>Dates:</th>
                  <td>
                    {{ cycle.start_date.strftime("%b %d, %Y") }} - {{
                    cycle.end_date.strftime("%b %d, %Y") }}
                  </td>
                </tr>
                <tr>
                  <th>Test Location:</th>
                  <td>CISA/VM Lab</td>
                </tr>
                <tr>
                  <th>Service:</th>
                  <td>Continuous Phishing Assessment</td>
                </tr>
                <tr>
                  <th>Scope:</th>
                  <td>
                    {{ cycle.target_count }} users within the following
                    domain[s]:<br />
                    {{ subscription.target_domain }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 3 - Report Instructions -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Instructions</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div id="reportInstructions">
              <section>
                <p>
                  The CON-PCA Phishing Assessments are organized into 90-day
                  campaigns in which each of your users will be phished once
                  every 90 days from the start of your subscription.
                </p>
                <p class="mb-0">
                  Each of these individuals here after referred to as targets
                  are tracked on two potential actions.
                </p>
                <ol>
                  <li>Opening the email</li>
                  <li>Clicked a malicious link</li>
                </ol>
                <p>
                  To track statistics on the reported email, that information
                  must be supplied to CISA in the required format or a reporting
                  mailbox must be available and advertised in the consuming
                  organization.
                </p>
                <p>
                  Most organizations will setup a reporting mailbox that
                  employees can forward suspicious emails to for further
                  investigation. In order to determine some statics such as time
                  to first report, the email content, the target email address,
                  and time of first report will be required to determine those
                  statics.
                </p>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 4 - Executive Report-->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Executive Report</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="executiveReportDetails">
              <p>
                This report provides the results for the CISA National
                Cybersecurity Assessments and Technical Services -
                (Vulnerability Management) led Continuous Phishing Campaign
                Assessment (CON-PCA) for {{ customer.name }}. The CON-PCA is a
                practical exercise intended to support and measure the
                effectiveness of security awareness training for information
                system users. The results of this CON-PCA show the
                susceptibility of {{ customer.identifier }} personnel to social
                engineering attacks—specifically email phishing attacks—in which
                an adversary tricks an email user into clicking a malicious link
                to gain unauthorized network access. In the scenario that this
                CON-PCA tested, the phishing attack bypassed technical controls
                that would normally detect and/or block malicious emails and
                links. The CON-PCA, therefore, measured {{ customer.name }}’s
                level of vulnerability to a successful phishing attack by
                targeted user click rates, click times, response rates, and
                response times, as shown in Table 1.
              </p>

              <p>
                This report aims to enhance {{ customer.name }}'s understanding
                of their information system users’ cybersecurity behavior and to
                promote a more secure and resilient workforce.
              </p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="table-title">Table 1: Targeted User Measurements</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <table class="report-table w-100 mb-5">
              <tr>
                <th>User Activity Metrics</th>
                <th>Results</th>
              </tr>
              <tr>
                <td>Total users targeted for phishing</td>
                <td>{{ cycle.target_count }}</td>
              </tr>
              <tr>
                <td># of emails (phishing attempts) sent overall</td>
                <td>{{ stats.stats.all.sent.count }}</td>
              </tr>
              <tr>
                <td>
                  # of clicked emails (successful phishing attempts) overall
                </td>
                <td>
                  {{ stats.stats.all.clicked.count }} ({{
                  stats.stats.all.clicked.ratio * 100 }}% click rate)
                </td>
              </tr>
              <tr>
                {% set average_click_time =
                time.convert_seconds(stats.stats.all.clicked.average) %}
                <td>Average time to first click</td>
                <td>
                  {{ average_click_time.hours }} hours, {{
                  average_click_time.minutes }} minutes, {{
                  average_click_time.seconds }} seconds
                </td>
              </tr>
              <tr>
                {% set most_successful_template = stats.template_stats |
                sort(attribute="clicked.ratio", reverse=True) | first %}
                <td>Most successful phishing template</td>
                <td>
                  Level {{ most_successful_template.template.deception_score }}
                  "{{ most_successful_template.template.name }}"
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p>
              Vulnerability Management has provided this CON-PCA to {{
              customer.name }} at no cost and coordinated all
              activities—including planning and testing–with {{ customer.name
              }}'s point of contact. {{ customer.name }} maintained control over
              the testing, including providing target email addresses, approving
              phishing email templates, approving testing timeframes, and
              adjusting mail security setting to ensure inbox access. This
              CON-PCA was not intended to, and did not, test technical controls
              or electronic protections designed to block phishing attempts.
              This CON-PCA spanned a six-week period and aimed to capture
              behavior-based metrics of {{ customer.name }} information system
              users’ reaction to phishing emails of multiple complexity levels.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 5 - Summary -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Summary</h2>
          </div>
        </div>

        <!-- Template Stats Table -->
        <div class="row">
          <div class="col-12">
            <p class="table-title">Table 2: Template Stats</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <table class="templatesTable">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Level</th>
                  <th>Template Subject</th>
                  <th>Emails Sent</th>
                  <th>Unique Clicks</th>
                  <th>Click Rate</th>
                </tr>
              </thead>
              <tbody>
                {% for t in cycle.stats.template_stats |
                sort(attribute="clicked.ratio") %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ t.template.deception_score }}</td>
                  <td>{{ t.template.subject }}</td>
                  <td>{{ t.sent.count }}</td>
                  <td>{{ t.clicked.count }}</td>
                  <td>{{ t.clicked.ratio * 100 }}%</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="row" style="margin-top: 25px">
          <div class="col-12">
            <p class="table-title">Graph 1: Deception Score Stats</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <canvas id="bar-stats-by-deception" class="d-flex report-chart">
              <script>
                createStatsByDeceptionChart();
              </script>
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 6 - SUMMARY CONT. -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Summary Cont.</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="table-title">Graph 2 - Click Time Interval Chart</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <canvas
              id="click-rate-time-interval"
              class="d-flex report-chart"
              style="height: 15rem"
            >
              <script>
                clickRateTimeIntervalChart();
              </script>
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Deception Levels -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Deception Levels</h2>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <p>
              The phishing templates used throughout this service include six
              levels of varying deception. Each level is based on a calculation
              of the factors designed to entice users to click on a malicious
              link. An explanation of the four factors used when determining an
              email’s level of deception can be found in "Deception Calculator”.
              The following defines key differences between each level:
            </p>

            <div style="text-indent: -10px; margin-left: 30px">
              <p>
                <b>Level 1 - </b>This level will be the easiest to detect and
                features common scams that are easily identified. Templates will
                usually include low deception indicators such as bad grammar,
                fake domains, and unknown external senders. Commonly the emails
                will appeal to emotions of greed, monetary gain, or guilt to
                elicit a user’s response.
              </p>
              <p>
                <b>Level 2 - </b>These email templates also use low deception
                indicators in that they typically appear to be from an external,
                unauthoritative sender. The templates use one higher deception
                indicator such as decent or proper grammar and are written in a
                tone of urgency to help the email appear genuine. They also
                commonly appeal to emotions of greed, monetary gain, or guilt.
              </p>
              <p>
                <b>Level 3 -</b>These are email scams that usually use two
                higher deception indicators such as appearing to be from a
                legitimate external organization or spoofing a known internal
                office or job title, but the link is usually fake and not
                associated with the content. Templates typically will include
                low deception indicators such as bad grammar or display fake
                domains. The theme of the templates can appeal to emotions or
                guilt and cause a sense of urgency if the request is not
                followed quickly.
              </p>
              <p>
                <b>Level 4 -</b>The email templates use more high deception
                indicators than low deception and frequently appear to come from
                a commonly found internal department, such as “IT Support” or
                “Human Resources”. The templates will request actions or
                information that real world departments would be trained not to
                ask users over email such as their passwords, private
                information, or financial accounts. The email templates will
                normally have decent grammar, but will be sent by a generic
                account internal with fake domains. The template can appeal to
                sense of urgency and fear of disciplinary action to elicit a
                user’s click.
              </p>
              <p>
                <b>Level 5 -</b>– This level includes seemingly common emails
                that might be sent from the respective organization and uses
                information gathered from publicly available sources to seem
                genuine. The templates usually come from internal and
                authoritative senders (high deception indicators) but with fake
                domains or generic information (lower deception indicators). The
                templates can appeal to a sense of fear and the need to comply
                with authority to elicit a user’s response.
              </p>
              <p>
                <b>Level 6 -</b> This level’s templates will be the hardest to
                detect and will typically have the highest click rate. These
                templates can appear to be from an internal office, personally
                address the recipient, and include themes such as negative
                policy changes and responses to internal and external news that
                may negatively affect employees. This level uses information
                gathered from public sources to develop the templates such as
                names of organizational individuals or departments, any relevant
                news, or information about specific organizational processes or
                tools.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Indicators -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Indicators</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="table-title">Indicator Stats</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <table id="indicatorStatsTable">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Group</th>
                  <th>Indicator</th>
                  <th>Value</th>
                  <th>Sent</th>
                  <th>Clicked</th>
                  <th>Percent</th>
                </tr>
              </thead>
              <tbody>
                {% for stat in cycle.stats.indicator_stats |
                sort(attribute="clicked.ratio", reverse=True) %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ stat.group | title }}</td>
                  <td>{{ stat.indicator | title }}</td>
                  <td>{{ stat.value }} ({{ stat.label }})</td>
                  <td>{{ stat.sent.count }}</td>
                  <td>{{ stat.clicked.count }}</td>
                  <td>{{ stat.clicked.ratio * 100 }}%</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Deception Calculator -->
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
            <h2 id="pageTitle">Deception Calculator</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="table-title">Deception Calculator</p>
            <table id="indicator-table">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Indicator</th>
                  <th>Ranking Scale</th>
                  {% for ts in cycle.stats.template_stats %}
                  <th class="rotate">
                    <div><span>{{ ts.template.name }}</span></div>
                  </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for group, gv in recommendations["indicators"].items() %} {%
                for indicator, iv in gv.items() %}
                <tr>
                  {% if loop.index == 1 %}
                  <th
                    rowspan="{{ gv | length }}"
                    style="vertical-align: middle"
                  >
                    {{ group | title }}
                  </th>
                  {% endif %}
                  <td style="width: 75px">{{ iv.name }}</td>
                  <td style="width: 75px">
                    {% for value, v in iv["values"].items() %}{% if loop.last
                    %}{{ value }}={{ v["label"] }}{% else %}{{ value }}={{
                    v["label"] }}, {% endif %}{% endfor %}
                  </td>

                  {% for ts in cycle.stats.template_stats %}
                  <td>{{ ts.template.indicators[group][indicator] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %} {% endfor %}
                <tr id="indicator-table-total">
                  <td></td>
                  <td></td>
                  <td>Total</td>
                  {% for ts in cycle.stats.template_stats %}
                  <td>{{ ts.template.deception_score }}</td>
                  {% endfor %}
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- TEMPLATE PAGES -->
    {% for template in stats.template_stats | sort(attribute="clicked.ratio") %}
    <div class="page">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="template-stat-header">
              <table>
                <tr>
                  <td>Template Name:</td>
                  <td>{{ template.template.name }}</td>
                </tr>
                <tr>
                  <td>Deception Level:</td>
                  <td>
                    {{ template.template.deception_score }} ({{
                    template.deception_level | title }})
                  </td>
                </tr>
                <tr>
                  <td>Total Sent:</td>
                  <td>{{ template.sent.count }}</td>
                </tr>
                <tr>
                  <td>Unique Clicks:</td>
                  <td>{{ template.clicked.count }}</td>
                </tr>
                <tr>
                  <td>Click Rate:</td>
                  <td>{{ template.clicked.ratio * 100 }}%</td>
                </tr>
              </table>
            </div>
            <div class="row" style="margin-bottom: 10px">
              <div class="col-12">
                <div class="template-body">
                  <b>Subject:</b>
                  {{ preview_template(template.template.subject, customer) }}<br />
                  <b style="margin-bottom: 1rem">From:</b>
                  {{ preview_from_address(template.template, subscription,
                  customer) }}<br />
                  <div class="template-html">
                    {{ template.template.html | safe }}
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <p>
                  <b>Key Characteristics: </b>
                  {% if template.template.deception_score <= 1 %} These poorly
                  worded or purposefully vague messages are self-filtering. If
                  someone is curious, greedy, or gullible enough to believe the
                  sender then they are more likely to follow through with the
                  request for personal or banking information. {% elif
                  template.template.deception_score == 2 %} These purposefully
                  vague messages attempt to short circuit common sense security
                  training by looking somewhat work related or evoke enough
                  curiosity click the link to learn more, even though the
                  message comes from an external sending domain and has unusual
                  misspellings for a professional or automated email. {% elif
                  template.template.deception_score == 3 %} Typically
                  impersonating a legitimate business interaction, these
                  messages are more focused on their target, but are still
                  self-filtering for more gullible recipients by using poor
                  grammar or following unusual business practices.{% elif
                  template.template.deception_score == 4 %}These messages are
                  specific to work environments or try to blend in as typical or
                  expected communications. Goal is usually to harvest
                  credentials to later gain access to sensitive business
                  networks since people tend to reuse credentials over several
                  platforms. Typical phishing techniques include spoofing a
                  sending address to look like a legitimate group, individually
                  addressing the recipient, and having a display name and
                  signature of group typically seen in the workplace. {% elif
                  template.template.deception_score == 5 %} Second highest level
                  of deception, these messages typically target specific
                  organizations or groups that access a common resource. In real
                  attacks, the goal is to have a recipient to download a
                  malicious program on their workstation to give the attacker
                  access to the internal network. Typical advanced phishing
                  techniques include using all hidden or spoofed links that
                  require the extra step of hovering over (or long pressing on
                  mobile) to show the underlying URL and spoofing or mimicking
                  the target organization’s email domain or signature block. {%
                  else %} The highest level of deception, these are usually
                  fine-tuned for sensitive account access or deep-pocket
                  credential harvesting and rely on customized content to convey
                  a sense of legitimacy. Typical advanced phishing techniques
                  include personally addressing the recipient, spoofing or
                  mimicking the organization’s email domain or signature block,
                  referencing relevant real world events or data, and writing in
                  a tone that motivates the recipient is to act.{% endif %}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </body>
</html>
