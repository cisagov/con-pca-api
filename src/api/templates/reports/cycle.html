<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cycle Status Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/cycle_report.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='image/favicon.ico') }}"
    />
    <script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chartjs-plugin-datalabels.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/reports.js') }}"></script>
  </head>

  <body class="mat-typography">
    {% for t in stats.template_stats %}
    <div style="width: 8.5in; height: 11in; margin: 10px" class="p-0">
      <h2>Level {{ t.template.deception_score }} Template</h2>
      <b>Subject: {{ preview_template(t.template.subject, customer) }}</b><br />
      <b>From: {{ preview_template(t.template.from_address, customer) }}</b
      ><br />
      <div
        style="
          width: 50%;
          border-left: 2px solid;
          border-right: 2px solid;
          border-bottom: 2px solid;
          border-top: 2px solid;
          padding: 1rem;
        "
      >
        {{ t.template.html | safe }}
        <br />
      </div>
      <p><b>Key Characteristics:</b> Some key characteristics</p>
      <p><b>Total emails sent:</b> {{ t.sent.count }}</p>
      <p><b>Unique targets who clicked:</b> {{ t.clicked.count }}</p>
      <p><b>Unique click rate:</b> {{ t.clicked.ratio * 100 }}%</p>
    </div>
    {% endfor %}
    <div style="width: 8.5in; height: 11in; margin: 10px" class="p-0">
      <table class="table">
        <tr>
          <thead class="thead-dark">
            <th scope="col">Level</th>
            <th scope="col">Template Subject</th>
            <th scope="col">User Click Rate</th>
            <th scope="col">Unique Clicks</th>
          </thead>
        </tr>
        {% for t in cycle.stats.template_stats %}
        <tr>
          <th scope="row">{{ t.template.deception_score }}</th>
          <td>{{ t.template.subject }}</td>
          <td>{{ (t.clicked.ratio * 100) | int }}%</td>
          <td>{{ t.clicked.count }}</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <div style="width: 8.5in; height: 11in; margin: 10px" class="p-0">
      <table id="indicator-table" class="table table-striped">
        <thead class="thead-dark">
          <tr>
            <th>Category</th>
            <th>Indicator</th>
            <th>Ranking Scale</th>
            {% for ts in cycle.stats.template_stats %}
            <th class="rotate">
              <div><span>{{ ts.template.name }}</span></div>
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for group, gv in recommendations["indicators"].items() %} {% for
          indicator, iv in gv.items() %}
          <tr>
            {% if loop.index == 1 %}
            <th rowspan="{{ gv | length }}">{{ group | title }}</th>
            {% endif %}
            <td>{{ iv.name }}</td>
            <td>
              {% for value, v in iv["values"].items() %}{% if loop.last %}{{
              value }}={{ v["label"] }}{% else %}{{ value }}={{ v["label"] }},
              {% endif %}{% endfor %}
            </td>

            {% for ts in cycle.stats.template_stats %}
            <td>{{ ts.template.indicators[group][indicator] }}</td>
            {% endfor %}
          </tr>
          {% endfor %} {% endfor %}
          <tr id="indicator-table-total">
            <td></td>
            <td></td>
            <td>Total</td>
            {% for ts in cycle.stats.template_stats %}
            <td>{{ ts.template.deception_score }}</td>
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
